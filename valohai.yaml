- step:
    name: load_data
    image: docker.io/python:3.10
    environment: pro-trial-prod-oci-vm-gpu-a10-1
    command:
      - pip install -r requirements.txt
      - python load_dataset.py {parameters}
    parameters:
      - name: dataset
        type: string
        default: "stanfordnlp/sst2"
      - name: tokenizer
        type: string
        default: "bert-base-multilingual-cased"
- step:
    name: train
    image: nvidia/cuda:11.8.0-cudnn8-runtime-ubuntu22.04
    environment: pro-trial-prod-oci-vm-gpu-a10-1
    command:
      - apt-get update && apt-get install -y python3-pip
      - pip install --upgrade pip
      - pip install torch==2.7.1+cu118 torchvision==0.18.1+cu118 torchaudio==2.7.1+cu118 --index-url https://download.pytorch.org/whl/cu118 --force-reinstall
      - pip install -r requirements.txt
      - python3 train.py {parameters}
    inputs:
      - name: tokenized_data
        default: dataset://sst2/version1
        description: Tokenized dataset zip file
    parameters:
      - name: tokenizer
        type: string
        default: "bert-base-multilingual-cased"
      - name: epochs
        type: integer
        default: 1
      - name: batch_size
        type: integer
        default: 8
      - name: learning_rate
        type: float
        default: 5e-5
      - name: num_labels
        type: integer
        default: 2
      - name: logging_steps
        type: integer
        default: 10
